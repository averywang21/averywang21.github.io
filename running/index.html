<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avery's 2026 NYC Half Training Plan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* Tailwind's gray-50 */
        }
        .calendar-grid {
            grid-template-columns: repeat(7, minmax(0, 1fr));
        }
        .workout-card {
            min-height: 120px;
            cursor: pointer;
        }
        .workout-type {
            font-size: 0.75rem; /* text-xs */
            line-height: 1rem;
        }
        .workout-details {
            font-size: 0.875rem; /* text-sm */
            line-height: 1.25rem;
        }
        .day-label {
             font-size: 0.75rem; /* text-xs */
             line-height: 1rem;
             font-weight: 600; /* semibold */
             color: #4b5563; /* text-gray-600 */
             margin-bottom: 0.25rem; /* mb-1 */
        }
        .race-a { /* A Race: Main Goal (Deep Purple) */
            background: linear-gradient(45deg, #a78bfa, #8b5cf6);
            color: white;
        }
        .race-b { /* B Race: Important Tune-up (Vibrant Red) */
             background: linear-gradient(45deg, #f87171, #ef4444);
             color: white;
           }
        
        @keyframes pulse {
            0%, 100% {
                transform: scale(1.04);
                box-shadow: 0 0 15px rgba(14, 165, 233, 0.4);
            }
            50% {
                transform: scale(1.06);
                box-shadow: 0 0 25px rgba(14, 165, 233, 0.6);
            }
        }

        .selected-day {
            border: 3px solid #0ea5e9; /* Sky blue border */
            z-index: 10;
            animation: pulse 2.5s infinite ease-in-out;
        }

        .past-day {
            position: relative;
            opacity: 0.7;
        }
        .past-day::before, .past-day::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 10%;
            width: 80%;
            height: 3px;
            background-color: rgba(107, 114, 128, 0.5);
            border-radius: 9999px;
            z-index: 20;
        }
        .past-day::before {
            transform: translate(0, -50%) rotate(45deg);
        }
        .past-day::after {
            transform: translate(0, -50%) rotate(-45deg);
        }
        /* Style for placeholder divs for grid alignment */
        .grid-placeholder {
             background-color: transparent; /* Invisible */
             border-radius: 0.5rem; /* rounded-lg */
             padding: 0.5rem; /* p-2 */
        }

    </style>
</head>
<body class="bg-gray-50 p-4 sm:p-6 md:p-8">
    <div class="max-w-7xl mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-800">Avery's 2026 NYC Half Training Plan</h1>
            <p id="goal-subtitle" class="text-md text-gray-500 mt-1">Pfitz HM Plan 30-55 mpw (Modified)</p>
        </header>

        <!-- Dashboard Section -->
        <div class="bg-white p-6 rounded-2xl shadow-lg grid grid-cols-1 lg:grid-cols-5 gap-6 mb-8 items-stretch">
            <!-- Countdown -->
            <div class="lg:col-span-1 flex flex-col">
                <h3 class="font-bold text-gray-800 mb-2 text-left">Race Countdown</h3>
                <div class="bg-violet-50 p-4 rounded-lg text-center flex-grow flex flex-col justify-center">
                    <p id="countdown" class="text-6xl font-bold text-violet-500">--</p>
                    <p class="text-xs text-gray-500">Days Remaining</p>
                </div>
            </div>

            <!-- Selected Workout -->
            <div class="lg:col-span-2 flex flex-col">
                <h3 id="selected-workout-title" class="font-bold text-gray-800 mb-2 text-left">Today's Workout</h3>
                <div id="selected-workout-card" class="p-4 rounded-lg text-center transition-colors duration-300 flex-grow flex flex-col justify-center">
                    <p id="selected-workout-date" class="font-semibold text-gray-500">--</p>
                    <p id="selected-workout-type" class="font-bold text-lg text-gray-800">--</p>
                    <p id="selected-workout-details" class="text-sm text-gray-600">--</p>
                </div>
                 <div class="bg-gray-50 p-4 rounded-lg text-center mt-4">
                    <p class="text-xs font-semibold text-gray-500 uppercase">Suggested Pace:</p>
                    <p id="suggested-pace-text" class="text-sm text-gray-800 font-bold"></p>
                </div>
            </div>
            
            <!-- Daily Briefing -->
            <div class="lg:col-span-2 flex flex-col">
                <h3 class="font-bold text-gray-800 mb-2 text-left">Daily Briefing</h3>
                <div class="bg-gray-50 p-4 rounded-lg flex-grow flex flex-col">
                        <div class="text-center mb-2">
                            <button id="quote-toggle-btn" class="text-xs font-semibold text-white bg-gray-800 hover:bg-black py-1 px-3 rounded-full transition-colors">
                                Switch to Goggins Mode
                            </button>
                        </div>
                    <hr class="border-gray-200 my-2">
                    <div class="flex-grow flex flex-col text-center min-h-0">
                        <p id="goggins-quote-text" class="text-sm text-gray-700 italic w-full h-full overflow-y-auto pr-2"></p>
                    </div>
                    <p id="goggins-attribution" class="text-xs text-gray-500 font-bold not-italic text-right w-full mt-2 flex-shrink-0"></p>
                </div>
            </div>
        </div>
        
        <!-- Calendar Section - Now with phase navigation -->
        <div class="bg-white p-4 sm:p-6 rounded-2xl shadow-lg">
            <div class="flex justify-between items-center mb-4">
                 <button id="prev-phase-btn" class="p-2 rounded-full hover:bg-gray-100 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                     <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                 </button>
                 <h2 id="phase-title" class="text-xl sm:text-2xl font-bold text-gray-800 text-center"></h2>
                 <button id="next-phase-btn" class="p-2 rounded-full hover:bg-gray-100 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                     <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                 </button>
             </div>
             <div id="calendar-container">
                 <!-- Calendar grid for the current phase will be dynamically generated here -->
             </div>
        </div>
    </div>

    <script>
        // Default quotes (can be customized later)
        const defaultQuotes = {
            "Rest": { quote: "Rest day? You think your enemies are resting? Stay hard.", sappy_quote: "Embrace the quiet strength of recovery." },
            "Aerobic": { quote: "Just miles. Get it done. Don't be soft.", sappy_quote: "Find your rhythm and enjoy the steady flow." },
            "Endurance": { quote: "Long run. Your appointment with the truth. Go suffer.", sappy_quote: "Building endurance, one step at a time. Believe in your strength." },
            "Threshold": { quote: "Threshold day. Get comfortable being uncomfortable. Take its soul.", sappy_quote: "Dancing on the edge of effort and grace. Feel your power." },
            "VO2 Max": { quote: "VO2 Max. This is gonna hurt. Good. Go to war.", sappy_quote: "Unlocking your top speed. Shine bright!" },
            "Progression": { quote: "Finish strong. Faster and faster. Dominate the end.", sappy_quote: "Building pace, building confidence. Finish with joy." },
            "Recovery": { quote: "Recovery run? Slow down. Discipline isn't just about going hard.", sappy_quote: "Gentle miles to thank your body and prepare for tomorrow." },
            "Race Pace": { quote: "Race pace. Lock it in. This is the feel of victory.", sappy_quote: "Dialing in that perfect rhythm. Smooth and strong." },
            "A Race": { quote: "RACE DAY. GO TO WAR. TAKE SOULS. STAY HARD.", sappy_quote: "This is your day! Celebrate your journey. Run with joy!" },
            "B Race": { quote: "Tune-up race. Execute the plan. Show them what's coming.", sappy_quote: "Test your fitness, enjoy the energy. Have fun!" }
        };

        const trainingData = {
            // PHASE 1A
            "2025-10-27": { type: "Rest", details: "Rest", ...defaultQuotes["Rest"] },
            "2025-10-28": { type: "Aerobic", details: "5 mi", ...defaultQuotes["Aerobic"] },
            "2025-10-29": { type: "Aerobic", details: "6 mi", ...defaultQuotes["Aerobic"] },
            "2025-10-30": { type: "Aerobic", details: "3 mi", ...defaultQuotes["Aerobic"] },
            "2025-10-31": { type: "Rest", details: "Rest", ...defaultQuotes["Rest"] },
            "2025-11-01": { type: "Endurance", details: "10 mi", ...defaultQuotes["Endurance"] },
            "2025-11-02": { type: "Aerobic", details: "6 mi", ...defaultQuotes["Aerobic"] }, 
            "2025-11-03": { type: "Rest", details: "Rest", ...defaultQuotes["Rest"] },
            "2025-11-04": { type: "Aerobic", details: "5 mi", ...defaultQuotes["Aerobic"] },
            "2025-11-05": { type: "Aerobic", details: "6 mi", ...defaultQuotes["Aerobic"] },
            "2025-11-06": { type: "Aerobic", details: "3 mi", ...defaultQuotes["Aerobic"] },
            "2025-11-07": { type: "Rest", details: "Rest", ...defaultQuotes["Rest"] },
            "2025-11-08": { type: "Endurance", details: "10 mi", ...defaultQuotes["Endurance"] },
            "2025-11-09": { type: "Aerobic", details: "6 mi", ...defaultQuotes["Aerobic"] },
            "2025-11-10": { type: "Rest", details: "Rest", ...defaultQuotes["Rest"] },
            "2025-11-11": { type: "Aerobic", details: "6 mi", ...defaultQuotes["Aerobic"] }, // Strides removed as per Phase 1A name
            "2025-11-12": { type: "Aerobic", details: "7 mi", ...defaultQuotes["Aerobic"] },
            "2025-11-13": { type: "Aerobic", details: "3 mi", ...defaultQuotes["Aerobic"] },
            "2025-11-14": { type: "Rest", details: "Rest", ...defaultQuotes["Rest"] },
            "2025-11-15": { type: "Endurance", details: "10 mi", ...defaultQuotes["Endurance"] },
            "2025-11-16": { type: "Aerobic", details: "7 mi", ...defaultQuotes["Aerobic"] },
            // PHASE 1B
            "2025-11-17": { type: "Rest", details: "Rest", ...defaultQuotes["Rest"] },
            "2025-11-18": { type: "Threshold", details: "7 mi<br>18' @ LT", ...defaultQuotes["Threshold"] },
            "2025-11-19": { type: "Aerobic", details: "7 mi", ...defaultQuotes["Aerobic"] },
            "2025-11-20": { type: "Aerobic", details: "3 mi", ...defaultQuotes["Aerobic"] },
            "2025-11-21": { type: "Rest", details: "Rest", ...defaultQuotes["Rest"] },
            "2025-11-22": { type: "Endurance", details: "11 mi", ...defaultQuotes["Endurance"] },
            "2025-11-23": { type: "Aerobic", details: "8 mi", ...defaultQuotes["Aerobic"] },
            "2025-11-24": { type: "Rest", details: "Rest", ...defaultQuotes["Rest"] },
            "2025-11-25": { type: "Aerobic", details: "7 mi<br>8x100", ...defaultQuotes["Aerobic"] }, // Added strides back for Phase 1B
            "2025-11-26": { type: "Aerobic", details: "7 mi", ...defaultQuotes["Aerobic"] },
            "2025-11-27": { type: "Aerobic", details: "3 mi", ...defaultQuotes["Aerobic"] },
            "2025-11-28": { type: "Rest", details: "Rest", ...defaultQuotes["Rest"] },
            "2025-11-29": { type: "Endurance", details: "11 mi", ...defaultQuotes["Endurance"] },
            "2025-11-30": { type: "Aerobic", details: "8 mi", ...defaultQuotes["Aerobic"] },
            "2025-12-01": { type: "Rest", details: "Rest", ...defaultQuotes["Rest"] },
            "2025-12-02": { type: "Threshold", details: "8 mi<br>20' @ LT", ...defaultQuotes["Threshold"] },
            "2025-12-03": { type: "Aerobic", details: "8 mi", ...defaultQuotes["Aerobic"] },
            "2025-12-04": { type: "Aerobic", details: "4 mi", ...defaultQuotes["Aerobic"] },
            "2025-12-05": { type: "Rest", details: "Rest", ...defaultQuotes["Rest"] },
            "2025-12-06": { type: "Endurance", details: "11 mi", ...defaultQuotes["Endurance"] },
            "2025-12-07": { type: "Aerobic", details: "8 mi", ...defaultQuotes["Aerobic"] },
            // PHASE 2A
            "2025-12-08": { type: "Rest", details: "Rest", ...defaultQuotes["Rest"] },
            "2025-12-09": { type: "Threshold", details: "7 mi<br>14', 12' @ LT", ...defaultQuotes["Threshold"] },
            "2025-12-10": { type: "Endurance", details: "8 mi", ...defaultQuotes["Endurance"] },
            "2025-12-11": { type: "Recovery", details: "3 mi", ...defaultQuotes["Recovery"] },
            "2025-12-12": { type: "Rest", details: "Rest", ...defaultQuotes["Rest"] },
            "2025-12-13": { type: "Endurance", details: "10 mi", ...defaultQuotes["Endurance"] },
            "2025-12-14": { type: "Aerobic", details: "6 mi<br>8x100", ...defaultQuotes["Aerobic"] },
            "2025-12-15": { type: "Rest", details: "Rest", ...defaultQuotes["Rest"] },
            "2025-12-16": { type: "Threshold", details: "8 mi<br>18', 12' @ LT", ...defaultQuotes["Threshold"] },
            "2025-12-17": { type: "Endurance", details: "8 mi", ...defaultQuotes["Endurance"] },
            "2025-12-18": { type: "Recovery", details: "3 mi", ...defaultQuotes["Recovery"] },
            "2025-12-19": { type: "Rest", details: "Rest", ...defaultQuotes["Rest"] },
            "2025-12-20": { type: "Endurance", details: "11 mi", ...defaultQuotes["Endurance"] },
            "2025-12-21": { type: "Aerobic", details: "7 mi<br>6x12\" uphill<br>8x100", ...defaultQuotes["Aerobic"] }, 
            "2025-12-22": { type: "Rest", details: "Rest", ...defaultQuotes["Rest"] },
            "2025-12-23": { type: "Threshold", details: "8 mi<br>18', 15' @ LT", ...defaultQuotes["Threshold"] },
            "2025-12-24": { type: "Endurance", details: "9 mi", ...defaultQuotes["Endurance"] },
            "2025-12-25": { type: "Recovery", details: "3 mi", ...defaultQuotes["Recovery"] },
            "2025-12-26": { type: "Rest", details: "Rest", ...defaultQuotes["Rest"] },
            "2025-12-27": { type: "Progression", details: "12 mi<br>last 2 mi @ LT", ...defaultQuotes["Progression"] },
            "2025-12-28": { type: "Aerobic", details: "8 mi<br>6x12\" uphill<br>8x100", ...defaultQuotes["Aerobic"] }, 
            "2025-12-29": { type: "Rest", details: "Rest", ...defaultQuotes["Rest"] },
            "2025-12-30": { type: "Aerobic", details: "8 mi<br>2x(5x150)", ...defaultQuotes["Aerobic"] },
            "2025-12-31": { type: "Aerobic", details: "7 mi", ...defaultQuotes["Aerobic"] },
            "2026-01-01": { type: "Recovery", details: "3 mi", ...defaultQuotes["Recovery"] },
            "2026-01-02": { type: "Rest", details: "Rest", ...defaultQuotes["Rest"] },
            "2026-01-03": { type: "Aerobic", details: "8 mi", ...defaultQuotes["Aerobic"] },
            "2026-01-04": { type: "Aerobic", details: "9 mi", ...defaultQuotes["Aerobic"] },
            // PHASE 2B
            "2026-01-05": { type: "Rest", details: "Rest", ...defaultQuotes["Rest"] },
            "2026-01-06": { type: "Threshold", details: "8 mi<br>25' @ LT", ...defaultQuotes["Threshold"] },
            "2026-01-07": { type: "Endurance", details: "10 mi", ...defaultQuotes["Endurance"] },
            "2026-01-08": { type: "Recovery", details: "4 mi", ...defaultQuotes["Recovery"] },
            "2026-01-09": { type: "Rest", details: "Rest", ...defaultQuotes["Rest"] },
            "2026-01-10": { type: "Endurance", details: "12 mi", ...defaultQuotes["Endurance"] },
            "2026-01-11": { type: "Aerobic", details: "7 mi<br>2x(6x100)", ...defaultQuotes["Aerobic"] },
            "2026-01-12": { type: "Rest", details: "Rest", ...defaultQuotes["Rest"] },
            "2026-01-13": { type: "Threshold", details: "9 mi<br>18', 14' @ LT", ...defaultQuotes["Threshold"] },
            "2026-01-14": { type: "Endurance", details: "11 mi", ...defaultQuotes["Endurance"] },
            "2026-01-15": { type: "Recovery", details: "4 mi", ...defaultQuotes["Recovery"] },
            "2026-01-16": { type: "Rest", details: "Rest", ...defaultQuotes["Rest"] },
            "2026-01-17": { type: "Endurance", details: "13 mi", ...defaultQuotes["Endurance"] },
            "2026-01-18": { type: "Aerobic", details: "7 mi<br>6x12\" uphill<br>8x100", ...defaultQuotes["Aerobic"] }, 
            "2026-01-19": { type: "Rest", details: "Rest", ...defaultQuotes["Rest"] },
            "2026-01-20": { type: "Threshold", details: "10 mi<br>20', 16' @ LT", ...defaultQuotes["Threshold"] },
            "2026-01-21": { type: "Endurance", details: "11 mi", ...defaultQuotes["Endurance"] },
            "2026-01-22": { type: "Recovery", details: "4 mi", ...defaultQuotes["Recovery"] },
            "2026-01-23": { type: "Rest", details: "Rest", ...defaultQuotes["Rest"] },
            "2026-01-24": { type: "Aerobic", details: "8 mi<br>6x12\" uphill<br>8x100", ...defaultQuotes["Aerobic"] }, 
            "2026-01-25": { type: "Progression", details: "14 mi<br>last 2 mi @ LT", ...defaultQuotes["Progression"] },
            "2026-01-26": { type: "Rest", details: "Rest", ...defaultQuotes["Rest"] },
            "2026-01-27": { type: "Aerobic", details: "10 mi", ...defaultQuotes["Aerobic"] }, 
            "2026-01-28": { type: "Aerobic", details: "10 mi", ...defaultQuotes["Aerobic"] }, 
            "2026-01-29": { type: "Recovery", details: "4 mi", ...defaultQuotes["Recovery"] },
            "2026-01-30": { type: "Rest", details: "Rest", ...defaultQuotes["Rest"] },
            "2026-01-31": { type: "Recovery", details: "5 mi<br>2x(5x150)", ...defaultQuotes["Recovery"] },
            "2026-02-01": { type: "B Race", details: "Manhattan 10k<br>(10 mi total)", ...defaultQuotes["B Race"] }, // Updated format
            // PHASE 3
            "2026-02-02": { type: "Rest", details: "Rest", ...defaultQuotes["Rest"] },
            "2026-02-03": { type: "Recovery", details: "9 mi", ...defaultQuotes["Recovery"] }, 
            "2026-02-04": { type: "Endurance", details: "13 mi", ...defaultQuotes["Endurance"] },
            "2026-02-05": { type: "Recovery", details: "5 mi", ...defaultQuotes["Recovery"] },
            "2026-02-06": { type: "Rest", details: "Rest", ...defaultQuotes["Rest"] },
            "2026-02-07": { type: "Aerobic", details: "8 mi<br>2x(6x100)", ...defaultQuotes["Aerobic"] },
            "2026-02-08": { type: "Threshold", details: "CARA MPH<br>40' @ LT<br>(12 mi total)", ...defaultQuotes["Threshold"] }, // Updated format
            "2026-02-09": { type: "Rest", details: "Rest", ...defaultQuotes["Rest"] },
            "2026-02-10": { type: "VO2 Max", details: "10 mi<br>3x1200, 3x1000 @ 5k", ...defaultQuotes["VO2 Max"] },
            "2026-02-11": { type: "Endurance", details: "12 mi", ...defaultQuotes["Endurance"] },
            "2026-02-12": { type: "Recovery", details: "5 mi", ...defaultQuotes["Recovery"] },
            "2026-02-13": { type: "Rest", details: "Rest", ...defaultQuotes["Rest"] },
            "2026-02-14": { type: "Progression", details: "14 mi<br>last 3 mi @ LT", ...defaultQuotes["Progression"] },
            "2026-02-15": { type: "Aerobic", details: "8 mi<br>6x12\" uphill<br>8x100", ...defaultQuotes["Aerobic"] }, 
            "2026-02-16": { type: "Rest", details: "Rest", ...defaultQuotes["Rest"] },
            "2026-02-17": { type: "VO2 Max", details: "10 mi<br>6x1200 @ 5k", ...defaultQuotes["VO2 Max"] },
            "2026-02-18": { type: "Endurance", details: "12 mi", ...defaultQuotes["Endurance"] },
            "2026-02-19": { type: "Recovery", details: "5 mi", ...defaultQuotes["Recovery"] },
            "2026-02-20": { type: "Rest", details: "Rest", ...defaultQuotes["Rest"] },
            "2026-02-21": { type: "Endurance", details: "16 mi", ...defaultQuotes["Endurance"] },
            "2026-02-22": { type: "Aerobic", details: "9 mi<br>10x100", ...defaultQuotes["Aerobic"] },
            "2026-02-23": { type: "Rest", details: "Rest", ...defaultQuotes["Rest"] },
            "2026-02-24": { type: "Aerobic", details: "7 mi", ...defaultQuotes["Aerobic"] }, 
            "2026-02-25": { type: "Endurance", details: "12 mi", ...defaultQuotes["Endurance"] }, 
            "2026-02-26": { type: "Recovery", details: "4 mi", ...defaultQuotes["Recovery"] }, 
            "2026-02-27": { type: "Rest", details: "Rest", ...defaultQuotes["Rest"] }, 
            "2026-02-28": { type: "Recovery", details: "4 mi<br>4x100", ...defaultQuotes["Recovery"] }, 
            "2026-03-01": { type: "B Race", details: "Napa Valley HM<br>(15 mi total)", ...defaultQuotes["B Race"] }, // Updated format
            // PHASE 4 (Combined Taper + Race)
            "2026-03-02": { type: "Rest", details: "Rest", ...defaultQuotes["Rest"] },
            "2026-03-03": { type: "Aerobic", details: "6 mi<br>2x(6x100)", ...defaultQuotes["Aerobic"] },
            "2026-03-04": { type: "Recovery", details: "4 mi", ...defaultQuotes["Recovery"] },
            "2026-03-05": { type: "VO2 Max", details: "9 mi<br>2x1200, 2x1000<br>1x800 @ 5k", ...defaultQuotes["VO2 Max"] },
            "2026-03-06": { type: "Rest", details: "Rest", ...defaultQuotes["Rest"] },
            "2026-03-07": { type: "Recovery", details: "3 mi", ...defaultQuotes["Recovery"] },
            "2026-03-08": { type: "Endurance", details: "10 mi", ...defaultQuotes["Endurance"] },
            "2026-03-09": { type: "Rest", details: "Rest", ...defaultQuotes["Rest"] },
            "2026-03-10": { type: "Race Pace", details: "7 mi<br>4x100<br>2 mi @ HMP", ...defaultQuotes["Race Pace"] },
            "2026-03-11": { type: "Recovery", details: "5 mi", ...defaultQuotes["Recovery"] },
            "2026-03-12": { type: "Recovery", details: "4 mi", ...defaultQuotes["Recovery"] },
            "2026-03-13": { type: "Rest", details: "Rest", ...defaultQuotes["Rest"] },
            "2026-03-14": { type: "Recovery", details: "3 mi<br>4x100", ...defaultQuotes["Recovery"] },
            "2026-03-15": { type: "A Race", details: "NYC Half<br>(15 mi total)", ...defaultQuotes["A Race"] }, // Updated details and format
            "2026-03-16": { type: "Rest", details: "Rest", quote: "You finished the war. Now recover like a champion.", sappy_quote: "You did it! Celebrate your incredible accomplishment and give your body the deep rest it deserves." },
            "2026-03-17": { type: "Rest", details: "Rest", quote: "Still resting? Good. Your body is a temple, not a damn amusement park.", sappy_quote: "Patience in recovery is a sign of wisdom. You are healing and getting stronger." },
            "2026-03-18": { type: "Recovery", details: "5 mi<br>4x100", quote: "Shake the rust off. You got more work to do this weekend. No one cares what you did last week.", sappy_quote: "Waking up the legs with a gentle run and some fun strides. Time to celebrate again!" },
            "2026-03-19": { type: "Recovery", details: "5 mi", quote: "Easy does it. Still shaking out the race legs.", sappy_quote: "Gentle movement to aid recovery. Listen to your body." },
            "2026-03-20": { type: "Rest", details: "Rest", quote: "Two races back to back? Get your mind right for the pain.", sappy_quote: "One final rest before a fun weekend of racing. You've earned this celebration." },
            "2026-03-21": { type: "VO2 Max", details: "Shamrock Mile<br>(3 mi total)", quote: "It's just one mile. Don't be a coward. Go to that dark place and stay there.", sappy_quote: "A chance to test your top-end speed! Run with power and celebrate your strength." },
            "2026-03-22": { type: "B Race", details: "Shamrock Shuffle 8k<br>(8 mi total)", quote: "You raced yesterday? So what? Did you forget to carry the boats? Your legs are screaming? GOOD. Tell them to shut their whiny little mouths. Go out there and run so hard that the leprechauns at the finish line give you their pot of gold out of pure fear. STAY HARD.", sappy_quote: "Two races in two days! What a spectacular and fun way to cap off the season. Let the festive atmosphere fill you with energy and joy. You are an inspiration!" }
        };

        const weeklyMileage = {
            "2025-10-27": "30 mi",
            "2025-11-03": "30 mi",
            "2025-11-10": "33 mi",
            "2025-11-17": "36 mi", // Start of Phase 1B
            "2025-11-24": "36 mi",
            "2025-12-01": "38 mi",
            "2025-12-08": "34 mi", // Start of Phase 2A
            "2025-12-15": "37 mi",
            "2025-12-22": "40 mi",
            "2025-12-29": "35 mi",
            "2026-01-05": "41 mi", // Start of Phase 2B
            "2026-01-12": "44 mi",
            "2026-01-19": "47 mi",
            "2026-01-26": "39 mi",
            "2026-02-02": "47 mi", // Start of Phase 3
            "2026-02-09": "50 mi",
            "2026-02-16": "52 mi",
            "2026-02-23": "42 mi",
            "2026-03-02": "32 mi", // Start of Combined Phase 4
            "2026-03-09": "34 mi", // Updated mileage
            "2026-03-16": "21 mi" 
        };
        
        const workoutColors = {
            "Rest": "bg-gray-100 text-gray-800", "Aerobic": "bg-cyan-100 text-cyan-800",
            "Endurance": "bg-yellow-100 text-yellow-800",    
            "Threshold": "bg-orange-100 text-orange-800", "Progression": "bg-yellow-100 text-yellow-800",
            "VO2 Max": "bg-red-200 text-red-800", "Recovery": "bg-green-100 text-green-800",
            "Race Pace": "bg-red-200 text-red-800", "A Race": "race-a", "B Race": "race-b", 
            "Bike": "bg-blue-100 text-blue-800", "Brick": "bg-teal-100 text-teal-800" 
        };
        const workoutTextColors = {
             "Rest": "text-gray-500", "Aerobic": "text-cyan-600",
            "Endurance": "text-yellow-700",    
            "Threshold": "text-orange-600", "Progression": "text-yellow-700",
            "VO2 Max": "text-red-600", "Recovery": "text-green-600",
            "Race Pace": "text-red-600", "A Race": "text-white", "B Race": "text-white", 
            "Bike": "text-blue-600", "Brick": "text-teal-600" 
        };
        
        const paceData = {
            "Recovery": "9:40+ min/mi",
            "Aerobic": "9:00 - 9:35 min/mi",
            "Endurance": "8:38 - 9:47 min/mi",
            "Threshold": "7:17 - 7:29 min/mi", // Corresponds to LT pace in plan
            "VO2 Max": "6:42 - 7:05 min/mi", // Corresponds to 5k pace in plan
            "Progression": "Start ~9:20, finish @ LT (~7:20)",
            "Race Pace": "7:17 - 7:29 min/mi", // HMP
            "B Race": "See specific race paces",
            "A Race": "Goal Race",
            "Rest": "N/A",
        };
        
        const racePaceData = {
            "Manhattan 10k": "Goal ~7:00 min/mi", // Example pace for B race
            "Napa Valley HM": "Tune-up Race Pace", // Example pace for B race
            "NYC Half": "Goal Pace: ~7:20 min/mi", // Example goal pace
            "Shamrock Mile": "~6:20 min/mi", // Example pace
            "Shamrock Shuffle 8k": "~6:55 min/mi" // Example pace
        };

        // --- Updated Phases Definition ---
        const phases = [
            { id: "phase-1a", name: "Phase 1A: Base", start: "2025-10-27", end: "2025-11-16" },
            { id: "phase-1b", name: "Phase 1B: Base + Speed", start: "2025-11-17", end: "2025-12-07" },
            { id: "phase-2a", name: "Phase 2A: Endurance + LT 1", start: "2025-12-08", end: "2026-01-04" },
            { id: "phase-2b", name: "Phase 2B: Endurance + LT 2", start: "2026-01-05", end: "2026-02-01" },
            { id: "phase-3", name: "Phase 3: Race Preparation", start: "2026-02-02", end: "2026-03-01" },
            { id: "phase-4", name: "Phase 4: Taper + Race", start: "2026-03-02", end: "2026-03-22" } // Combined phase
        ];

        document.addEventListener('DOMContentLoaded', () => {
            // --- STATE ---
            let currentPhaseIndex = 0; // Start with the first phase
            let isGogginsMode = false;
            const currentDate = new Date();
             currentDate.setHours(0,0,0,0); // Normalize current date
            let activeRaceGoal = { date: new Date('2026-03-15T00:00:00'), name: "NYC Half Marathon Goal Race" }; // Keep goal race date
            const goals = [
                { date: new Date('2026-03-15T00:00:00'), name: "NYC Half Marathon Goal Race" }
            ];
            // Define plan start and end dates consistently from the new data
            const planStartDate = new Date(phases[0].start + 'T00:00:00'); 
             planStartDate.setHours(0, 0, 0, 0); // Normalize start date
            const planEndDate = new Date(phases[phases.length - 1].end + 'T00:00:00'); // Updated end date
             planEndDate.setHours(0, 0, 0, 0); // Normalize end date


            // --- DOM ELEMENTS ---
            const dom = {
                goalSubtitle: document.getElementById('goal-subtitle'),
                countdown: document.getElementById('countdown'),
                selectedWorkout: {
                    title: document.getElementById('selected-workout-title'),
                    card: document.getElementById('selected-workout-card'),
                    date: document.getElementById('selected-workout-date'),
                    type: document.getElementById('selected-workout-type'),
                    details: document.getElementById('selected-workout-details'),
                },
                dailyBriefing: {
                    paceText: document.getElementById('suggested-pace-text'),
                    quoteText: document.getElementById('goggins-quote-text'),
                    attribution: document.getElementById('goggins-attribution'),
                },
                quoteToggleBtn: document.getElementById('quote-toggle-btn'),
                prevPhaseBtn: document.getElementById('prev-phase-btn'), // Get nav buttons
                nextPhaseBtn: document.getElementById('next-phase-btn'),
                phaseTitle: document.getElementById('phase-title'), // Get phase title element
                calendarContainer: document.getElementById('calendar-container'), // Single container
            };

            // --- FUNCTIONS ---

            function updateQuoteDisplay(dateString) {
                if (!dateString || !/^\d{4}-\d{2}-\d{2}$/.test(dateString)) return;
                const workout = trainingData[dateString];
                let quote, attribution;
                const workoutType = workout ? workout.type : "Rest"; 
                const quotesForType = defaultQuotes[workoutType] || defaultQuotes["Rest"]; 

                if (isGogginsMode) {
                    quote = workout?.quote || quotesForType.quote; 
                    attribution = "-- D. Goggins (probably)";
                } else {
                    quote = workout?.sappy_quote || quotesForType.sappy_quote; 
                    attribution = "";
                }
                dom.dailyBriefing.quoteText.innerHTML = quote ? `"${quote}"` : '"No quote available."';
                dom.dailyBriefing.attribution.textContent = attribution;
            }

            function updateCountdown(selectedDate) {
                 if (!(selectedDate instanceof Date) || isNaN(selectedDate)) return; 
                const raceDay = activeRaceGoal.date; // Countdown is always to the NYC Half
                const selectedDateNormalized = new Date(selectedDate);
                selectedDateNormalized.setHours(0,0,0,0);
                // If selected date is after the race day, show 0
                if (selectedDateNormalized > raceDay) {
                     dom.countdown.innerText = 0;
                     return;
                }
                const diffTime = raceDay - selectedDateNormalized; 
                const diffDays = Math.max(0, Math.ceil(diffTime / (1000 * 60 * 60 * 24)));
                dom.countdown.innerText = diffDays;
            }


            function selectDay(dateString, element) {
                if (!dateString || !/^\d{4}-\d{2}-\d{2}$/.test(dateString)) {
                    console.error("Invalid dateString passed to selectDay:", dateString);
                    const planStartString = planStartDate.toISOString().split('T')[0];
                    const startElement = document.getElementById(`day-${planStartString}`);
                    if (startElement) selectDay(planStartString, startElement);
                    return;
                }

                const previouslySelected = document.querySelector('.selected-day');
                if (previouslySelected) {
                    previouslySelected.classList.remove('selected-day');
                }
                if (element && element.classList.contains('workout-card') && !element.classList.contains('grid-placeholder')) { 
                    element.classList.add('selected-day');
                } else { 
                    const elById = document.getElementById(`day-${dateString}`);
                    if (elById && elById.classList.contains('workout-card') && !elById.classList.contains('grid-placeholder')) {
                        elById.classList.add('selected-day');
                    }
                 }

                const selectedDate = new Date(dateString + 'T12:00:00'); 
                if (isNaN(selectedDate.getTime())) { 
                     console.error("Created invalid date in selectDay from:", dateString);
                     const planStartString = planStartDate.toISOString().split('T')[0];
                     const startElement = document.getElementById(`day-${planStartString}`);
                     if (startElement) selectDay(planStartString, startElement);
                     return;
                }
                selectedDate.setHours(0, 0, 0, 0);
                
                // Keep activeRaceGoal fixed to NYC Half
                updateCountdown(selectedDate); 

                const todayNormalized = new Date(currentDate);
                todayNormalized.setHours(0,0,0,0);
                dom.selectedWorkout.title.innerText = (selectedDate.getTime() === todayNormalized.getTime())
                    ? "Today's Workout"
                    : "Selected Workout";

                const workout = trainingData[dateString];
                const workoutType = workout ? workout.type : "Rest";
                const { card, date, type, details } = dom.selectedWorkout;

                const oldBgClass = card.dataset.bgClass || '';
                if (oldBgClass) card.classList.remove(...oldBgClass.split(' '));
                const newBgClass = workoutColors[workoutType] || 'bg-gray-100'; 
                card.classList.add(...newBgClass.split(' '));
                card.dataset.bgClass = newBgClass;
                
                const workoutTextElements = [date, type, details];
                const oldTextClass = date.dataset.textClass || '';
                if(oldTextClass) workoutTextElements.forEach(el => el.classList.remove(oldTextClass));
                const newTextClass = workoutTextColors[workoutType] || 'text-gray-800'; 
                workoutTextElements.forEach(el => el.classList.add(newTextClass));
                date.dataset.textClass = newTextClass;

                date.innerText = selectedDate.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' });
                type.innerText = workout ? workout.type.replace(/\+/g, ' + ').replace("VO2 Max", "VO₂max") : "Rest Day"; 
                details.innerHTML = workout ? workout.details.replace(/\n/g, '<br>') : "No workout scheduled."; 
                
                 let paceText = paceData[workoutType] || 'N/A';
                 if (workoutType === "B Race" || workoutType === "A Race") {
                     let foundRacePace = false;
                     for (const raceName in racePaceData) {
                         // Use includes() for broader matching of race names in details
                         if (workout.details && typeof workout.details === 'string' && workout.details.includes(raceName)) {
                             paceText = racePaceData[raceName];
                             foundRacePace = true;
                             break;
                         }
                     }
                     // If no specific B/A race pace found in racePaceData, use the default from paceData
                     if (!foundRacePace) {
                          paceText = paceData[workoutType] || 'N/A'; // Ensure fallback
                     }
                 }
                 dom.dailyBriefing.paceText.innerHTML = paceText;


                updateQuoteDisplay(dateString);
            }

             function attachCalendarEventListeners() {
                 dom.calendarContainer.removeEventListener('click', handleDayClick); // Remove previous listener
                 dom.calendarContainer.addEventListener('click', handleDayClick);
             }

             function handleDayClick(event) {
                 const dayEl = event.target.closest('.workout-card');
                 if (dayEl && dayEl.dataset.dateString && !dayEl.classList.contains('grid-placeholder')) {
                     selectDay(dayEl.dataset.dateString, dayEl);
                 }
             }


            function renderCalendar(phaseIndex) {
                 if (phaseIndex < 0 || phaseIndex >= phases.length) return; // Index out of bounds

                 const phase = phases[phaseIndex];
                 const phaseStartDate = new Date(phase.start + 'T00:00:00');
                 phaseStartDate.setHours(0,0,0,0);
                 const phaseEndDate = new Date(phase.end + 'T00:00:00');
                 phaseEndDate.setHours(0,0,0,0);

                 // Update Phase Title
                 dom.phaseTitle.textContent = `${phase.name} (${(phaseStartDate.getMonth() + 1)}/${phaseStartDate.getDate()} - ${(phaseEndDate.getMonth() + 1)}/${phaseEndDate.getDate()})`;

                 const daysOfWeek = ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"];
                
                 // Calculate Grid Start/End Dates
                 const phaseStartWeekday = (phaseStartDate.getDay() + 6) % 7; 
                 let gridStartDate = new Date(phaseStartDate);
                 gridStartDate.setDate(phaseStartDate.getDate() - phaseStartWeekday);

                 const phaseEndWeekday = (phaseEndDate.getDay() + 6) % 7; 
                 let gridEndDate = new Date(phaseEndDate);
                 gridEndDate.setDate(phaseEndDate.getDate() + (6 - phaseEndWeekday));

                 let headerHTML = daysOfWeek.map(day => `<div class="text-center font-semibold text-gray-600 mb-1">${day}</div>`).join('');
                 let bodyHTML = '';
                 
                 const today = new Date(currentDate); // Already normalized

                 let currentDateIterator = new Date(gridStartDate);
                 while(currentDateIterator <= gridEndDate) {
                     const loopDate = new Date(currentDateIterator); 
                     loopDate.setHours(0,0,0,0); 

                     const dateString = `${loopDate.getFullYear()}-${String(loopDate.getMonth() + 1).padStart(2, '0')}-${String(loopDate.getDate()).padStart(2, '0')}`;
                     // --- Date Label Format Change ---
                     const dayLabel = `${loopDate.getMonth() + 1}/${loopDate.getDate()}`; // Format as M/D

                     const isWithinPhase = loopDate >= phaseStartDate && loopDate <= phaseEndDate;

                     // Check if the current date is within the overall plan dates
                     const isWithinPlan = loopDate >= planStartDate && loopDate <= planEndDate;


                     if (!isWithinPhase || !isWithinPlan) { // Render placeholder if outside phase OR outside overall plan
                         bodyHTML += `<div class="grid-placeholder"></div>`;
                     } else { // Day is within the phase dates AND within the overall plan dates
                         const workout = trainingData[dateString];
                         const workoutType = workout ? workout.type : 'Rest';

                         let cardClasses = 'workout-card relative flex flex-col p-2 rounded-lg transition-all duration-200 ease-in-out border border-transparent hover:border-sky-500';
                         cardClasses += ` ${workoutColors[workoutType] || 'bg-white'}`;
                         if (loopDate < today) cardClasses += ' past-day';
                         
                         let dayLabelClasses = 'day-label'; 
                         if((workoutType === "A Race" || workoutType === "B Race") && !cardClasses.includes('past-day')){
                             dayLabelClasses += ' text-white'; 
                         }

                         let mileageHTML = '';
                         if (loopDate.getDay() === 1 && isWithinPhase && weeklyMileage[dateString]) { 
                             mileageHTML = `<div class="absolute top-1.5 right-2 text-xs font-bold text-gray-400" title="Weekly Mileage Total">${weeklyMileage[dateString]}</div>`;
                         }
                         
                         const workoutDetailsCleaned = workout?.details?.replace(/\n/g, '<br>') || '';
                         const contentHTML = workout
                              ? `<div class="workout-type uppercase font-semibold opacity-80">${workout.type.replace(/\+/g, ' + ').replace("VO2 Max", "VO₂max")}</div>
                                 <div class="workout-details mt-1">${workoutDetailsCleaned}</div>`
                             : `<div class="workout-type uppercase font-semibold opacity-80">Rest</div>`;
                         
                         bodyHTML += `
                             <div id="day-${dateString}" data-date-string="${dateString}" class="${cardClasses}">
                                 ${mileageHTML}
                                 <div class="${dayLabelClasses}">${dayLabel}</div>
                                 ${contentHTML}
                             </div>`;
                     }
                     currentDateIterator.setDate(currentDateIterator.getDate() + 1);
                 }

                 // Update the single calendar container's innerHTML
                 dom.calendarContainer.innerHTML = `
                     <div class="calendar-grid grid gap-1">${headerHTML}</div>
                     <div class="calendar-grid grid gap-2 mt-1">${bodyHTML}</div>
                 `;

                 // Update navigation button states
                 dom.prevPhaseBtn.disabled = phaseIndex === 0;
                 dom.nextPhaseBtn.disabled = phaseIndex === phases.length - 1;
                 
                 attachCalendarEventListeners(); // Re-attach listeners for the new content

                 // Re-select the currently selected day visually if it exists in the new render
                 const selectedDateStr = document.querySelector('.selected-day')?.dataset.dateString;
                  if (selectedDateStr) {
                     const selectedEl = document.getElementById(`day-${selectedDateStr}`);
                     if (selectedEl && !selectedEl.classList.contains('grid-placeholder')) {
                          selectedEl.classList.add('selected-day');
                     }
                  }
            }


            function updateGogginsButton() {
                const isGoggins = isGogginsMode;
                dom.quoteToggleBtn.textContent = isGoggins ? 'Switch to Mantra Mode' : 'Switch to Goggins Mode';
                dom.quoteToggleBtn.classList.toggle('bg-gray-800', isGoggins);
                dom.quoteToggleBtn.classList.toggle('hover:bg-black', isGoggins);
                dom.quoteToggleBtn.classList.toggle('bg-blue-500', !isGoggins);
                dom.quoteToggleBtn.classList.toggle('hover:bg-blue-600', !isGoggins);
            }

            function changePhase(offset) {
                 const newPhaseIndex = currentPhaseIndex + offset;
                 if (newPhaseIndex >= 0 && newPhaseIndex < phases.length) {
                     currentPhaseIndex = newPhaseIndex;
                     renderCalendar(currentPhaseIndex);
                 }
            }
            
            // --- INITIALIZATION ---
            function init() {
                // Find the initial phase based on today's date
                 const today = new Date(currentDate); // Use normalized date
                 let initialPhaseIndex = 0;
                 for (let i = 0; i < phases.length; i++) {
                     const phaseStartDate = new Date(phases[i].start + 'T00:00:00');
                     phaseStartDate.setHours(0,0,0,0);
                     const phaseEndDate = new Date(phases[i].end + 'T00:00:00');
                      phaseEndDate.setHours(0,0,0,0);
                     if (today >= phaseStartDate && today <= phaseEndDate) {
                         initialPhaseIndex = i;
                         break;
                     }
                     if (today < phaseStartDate && i === 0) {
                          initialPhaseIndex = 0;
                          break;
                     }
                     if (today > phaseEndDate && i === phases.length - 1) {
                          initialPhaseIndex = i; // Default to last phase if date is past it
                          break;
                     }
                     // If today is between phases, default to the next one
                     if (i < phases.length - 1) {
                         const nextPhaseStart = new Date(phases[i+1].start + 'T00:00:00');
                         nextPhaseStart.setHours(0,0,0,0);
                         if (today > phaseEndDate && today < nextPhaseStart) {
                             initialPhaseIndex = i + 1;
                             break;
                         }
                     }
                 }
                 currentPhaseIndex = initialPhaseIndex;


                // Event Listeners for phase navigation
                dom.prevPhaseBtn.addEventListener('click', () => changePhase(-1));
                dom.nextPhaseBtn.addEventListener('click', () => changePhase(1));

                 // Goggins button listener
                 dom.quoteToggleBtn.addEventListener('click', () => {
                    isGogginsMode = !isGogginsMode;
                    updateGogginsButton();
                    const selectedDateStr = document.querySelector('.selected-day')?.dataset.dateString;
                    if (selectedDateStr) updateQuoteDisplay(selectedDateStr); 
                 });
                
                // Initial Render of the current phase
                renderCalendar(currentPhaseIndex); 
                
                // Determine which day to select initially
                const todayString = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
                const planStartString = planStartDate.toISOString().split('T')[0];
                const planEndString = planEndDate.toISOString().split('T')[0];
                let initialSelectDateString = planStartString; 
                
                updateGogginsButton(); 

                 if (today >= planStartDate && today <= planEndDate) {
                    initialSelectDateString = todayString; 
                 } else if (today > planEndDate) {
                    initialSelectDateString = planEndString; // Select the very last day of the plan
                 }
                
                 // Use setTimeout to ensure the elements exist after the initial render
                 setTimeout(() => {
                      // Check if the initialSelectDateString exists in trainingData OR if it's within the plan dates (for potential rest days not explicitly listed initially)
                      if (trainingData[initialSelectDateString] !== undefined || (new Date(initialSelectDateString) >= planStartDate && new Date(initialSelectDateString) <= planEndDate)) {
                         const initialElement = document.getElementById(`day-${initialSelectDateString}`);
                          if (initialElement) { 
                              selectDay(initialSelectDateString, initialElement);
                          } else {
                               // Fallback if element not found (e.g., date exists but isn't rendered in the initially visible phase)
                               // Select the first day of the *initial* phase instead
                                const firstDayOfInitialPhase = phases[initialPhaseIndex].start;
                                const firstDayElement = document.getElementById(`day-${firstDayOfInitialPhase}`);
                                if (firstDayElement) selectDay(firstDayOfInitialPhase, firstDayElement);
                                else { // Ultimate fallback to plan start
                                     const fallbackElement = document.getElementById(`day-${planStartString}`);
                                     if (fallbackElement) selectDay(planStartString, fallbackElement);
                                }
                          }
                     } else {
                         // Fallback if initialSelectDateString is truly invalid
                         const fallbackElement = document.getElementById(`day-${planStartString}`);
                          if (fallbackElement) selectDay(planStartString, fallbackElement);
                     }
                 }, 0); 
            }

            init(); // Run initialization
        });
    </script>
</body>
</html>

